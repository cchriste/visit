/*****************************************************************************
*
* Copyright (c) 2000 - 2012, Lawrence Livermore National Security, LLC
* Produced at the Lawrence Livermore National Laboratory
* LLNL-CODE-442911
* All rights reserved.
*
* This file is  part of VisIt. For  details, see https://visit.llnl.gov/.  The
* full copyright notice is contained in the file COPYRIGHT located at the root
* of the VisIt distribution or at http://www.llnl.gov/visit/copyright.html.
*
* Redistribution  and  use  in  source  and  binary  forms,  with  or  without
* modification, are permitted provided that the following conditions are met:
*
*  - Redistributions of  source code must  retain the above  copyright notice,
*    this list of conditions and the disclaimer below.
*  - Redistributions in binary form must reproduce the above copyright notice,
*    this  list of  conditions  and  the  disclaimer (as noted below)  in  the
*    documentation and/or other materials provided with the distribution.
*  - Neither the name of  the LLNS/LLNL nor the names of  its contributors may
*    be used to endorse or promote products derived from this software without
*    specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT  HOLDERS AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR  IMPLIED WARRANTIES, INCLUDING,  BUT NOT  LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS FOR A PARTICULAR  PURPOSE
* ARE  DISCLAIMED. IN  NO EVENT  SHALL LAWRENCE  LIVERMORE NATIONAL  SECURITY,
* LLC, THE  U.S.  DEPARTMENT OF  ENERGY  OR  CONTRIBUTORS BE  LIABLE  FOR  ANY
* DIRECT,  INDIRECT,   INCIDENTAL,   SPECIAL,   EXEMPLARY,  OR   CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT  LIMITED TO, PROCUREMENT OF  SUBSTITUTE GOODS OR
* SERVICES; LOSS OF  USE, DATA, OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER
* CAUSED  AND  ON  ANY  THEORY  OF  LIABILITY,  WHETHER  IN  CONTRACT,  STRICT
* LIABILITY, OR TORT  (INCLUDING NEGLIGENCE OR OTHERWISE)  ARISING IN ANY  WAY
* OUT OF THE  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
* DAMAGE.
*
*****************************************************************************/

#include "QvisPeaksOverThresholdWindow.h"

#include <PeaksOverThresholdAttributes.h>
#include <ViewerProxy.h>

#include <QCheckBox>
#include <QLabel>
#include <QLayout>
#include <QLineEdit>
#include <QSpinBox>
#include <QButtonGroup>
#include <QRadioButton>
#include <QvisColorTableButton.h>
#include <QvisOpacitySlider.h>
#include <QvisColorButton.h>
#include <QvisLineStyleWidget.h>
#include <QvisLineWidthWidget.h>
#include <QvisVariableButton.h>

#include <stdio.h>
#include <string>

using std::string;

// ****************************************************************************
// Method: QvisPeaksOverThresholdWindow::QvisPeaksOverThresholdWindow
//
// Purpose: 
//   Constructor
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

QvisPeaksOverThresholdWindow::QvisPeaksOverThresholdWindow(const int type,
                         PeaksOverThresholdAttributes *subj,
                         const QString &caption,
                         const QString &shortName,
                         QvisNotepadArea *notepad)
    : QvisOperatorWindow(type,subj, caption, shortName, notepad)
{
    atts = subj;
}


// ****************************************************************************
// Method: QvisPeaksOverThresholdWindow::~QvisPeaksOverThresholdWindow
//
// Purpose: 
//   Destructor
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

QvisPeaksOverThresholdWindow::~QvisPeaksOverThresholdWindow()
{
}


// ****************************************************************************
// Method: QvisPeaksOverThresholdWindow::CreateWindowContents
//
// Purpose: 
//   Creates the widgets for the window.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisPeaksOverThresholdWindow::CreateWindowContents()
{
    QGridLayout *mainLayout = new QGridLayout(0);
    topLayout->addLayout(mainLayout);

    aggregationLabel = new QLabel(tr("Aggregation"), central);
    mainLayout->addWidget(aggregationLabel,0,0);
    aggregation = new QWidget(central);
    aggregationButtonGroup= new QButtonGroup(aggregation);
    QHBoxLayout *aggregationLayout = new QHBoxLayout(aggregation);
    aggregationLayout->setMargin(0);
    aggregationLayout->setSpacing(10);
    QRadioButton *aggregationAggregationTypeANNUAL = new QRadioButton(tr("ANNUAL"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeANNUAL,0);
    aggregationLayout->addWidget(aggregationAggregationTypeANNUAL);
    QRadioButton *aggregationAggregationTypeSEASONAL = new QRadioButton(tr("SEASONAL"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeSEASONAL,1);
    aggregationLayout->addWidget(aggregationAggregationTypeSEASONAL);
    QRadioButton *aggregationAggregationTypeMONTHLY = new QRadioButton(tr("MONTHLY"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeMONTHLY,2);
    aggregationLayout->addWidget(aggregationAggregationTypeMONTHLY);
    connect(aggregationButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(aggregationChanged(int)));
    mainLayout->addWidget(aggregation, 0,1);

    annualPercentileLabel = new QLabel(tr("Annual Percentile"), central);
    mainLayout->addWidget(annualPercentileLabel,1,0);
    annualPercentile = new QLineEdit(central);
    connect(annualPercentile, SIGNAL(returnPressed()),
            this, SLOT(annualPercentileProcessText()));
    mainLayout->addWidget(annualPercentile, 1,1);

    seasonalPercentileLabel = new QLabel(tr("Seasonal Percentile"), central);
    mainLayout->addWidget(seasonalPercentileLabel,2,0);
    seasonalPercentile = new QLineEdit(central);
    connect(seasonalPercentile, SIGNAL(returnPressed()),
            this, SLOT(seasonalPercentileProcessText()));
    mainLayout->addWidget(seasonalPercentile, 2,1);

    monthlyPercentileLabel = new QLabel(tr("Monthly Percentile"), central);
    mainLayout->addWidget(monthlyPercentileLabel,3,0);
    monthlyPercentile = new QLineEdit(central);
    connect(monthlyPercentile, SIGNAL(returnPressed()),
            this, SLOT(monthlyPercentileProcessText()));
    mainLayout->addWidget(monthlyPercentile, 3,1);

    displaySeasonLabel = new QLabel(tr("Display Season"), central);
    mainLayout->addWidget(displaySeasonLabel,4,0);
    displaySeason = new QWidget(central);
    displaySeasonButtonGroup= new QButtonGroup(displaySeason);
    QHBoxLayout *displaySeasonLayout = new QHBoxLayout(displaySeason);
    displaySeasonLayout->setMargin(0);
    displaySeasonLayout->setSpacing(10);
    QRadioButton *displaySeasonSeasonTypeWINTER = new QRadioButton(tr("WINTER"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeWINTER,0);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeWINTER);
    QRadioButton *displaySeasonSeasonTypeSPRING = new QRadioButton(tr("SPRING"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeSPRING,1);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeSPRING);
    QRadioButton *displaySeasonSeasonTypeSUMMER = new QRadioButton(tr("SUMMER"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeSUMMER,2);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeSUMMER);
    QRadioButton *displaySeasonSeasonTypeFALL = new QRadioButton(tr("FALL"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeFALL,3);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeFALL);
    connect(displaySeasonButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(displaySeasonChanged(int)));
    mainLayout->addWidget(displaySeason, 4,1);

    displayMonthLabel = new QLabel(tr("Display Month"), central);
    mainLayout->addWidget(displayMonthLabel,5,0);
    displayMonth = new QWidget(central);
    displayMonthButtonGroup= new QButtonGroup(displayMonth);
    QHBoxLayout *displayMonthLayout = new QHBoxLayout(displayMonth);
    displayMonthLayout->setMargin(0);
    displayMonthLayout->setSpacing(10);
    QRadioButton *displayMonthMonthTypeJAN = new QRadioButton(tr("JAN"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJAN,0);
    displayMonthLayout->addWidget(displayMonthMonthTypeJAN);
    QRadioButton *displayMonthMonthTypeFEB = new QRadioButton(tr("FEB"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeFEB,1);
    displayMonthLayout->addWidget(displayMonthMonthTypeFEB);
    QRadioButton *displayMonthMonthTypeMAR = new QRadioButton(tr("MAR"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeMAR,2);
    displayMonthLayout->addWidget(displayMonthMonthTypeMAR);
    QRadioButton *displayMonthMonthTypeAPR = new QRadioButton(tr("APR"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeAPR,3);
    displayMonthLayout->addWidget(displayMonthMonthTypeAPR);
    QRadioButton *displayMonthMonthTypeMAY = new QRadioButton(tr("MAY"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeMAY,4);
    displayMonthLayout->addWidget(displayMonthMonthTypeMAY);
    QRadioButton *displayMonthMonthTypeJUN = new QRadioButton(tr("JUN"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJUN,5);
    displayMonthLayout->addWidget(displayMonthMonthTypeJUN);
    QRadioButton *displayMonthMonthTypeJUL = new QRadioButton(tr("JUL"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJUL,6);
    displayMonthLayout->addWidget(displayMonthMonthTypeJUL);
    QRadioButton *displayMonthMonthTypeAUG = new QRadioButton(tr("AUG"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeAUG,7);
    displayMonthLayout->addWidget(displayMonthMonthTypeAUG);
    QRadioButton *displayMonthMonthTypeSEP = new QRadioButton(tr("SEP"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeSEP,8);
    displayMonthLayout->addWidget(displayMonthMonthTypeSEP);
    QRadioButton *displayMonthMonthTypeOCT = new QRadioButton(tr("OCT"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeOCT,9);
    displayMonthLayout->addWidget(displayMonthMonthTypeOCT);
    QRadioButton *displayMonthMonthTypeNOV = new QRadioButton(tr("NOV"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeNOV,10);
    displayMonthLayout->addWidget(displayMonthMonthTypeNOV);
    QRadioButton *displayMonthMonthTypeDEC = new QRadioButton(tr("DEC"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeDEC,11);
    displayMonthLayout->addWidget(displayMonthMonthTypeDEC);
    connect(displayMonthButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(displayMonthChanged(int)));
    mainLayout->addWidget(displayMonth, 5,1);

    cutoffLabel = new QLabel(tr("Cutoff"), central);
    mainLayout->addWidget(cutoffLabel,6,0);
    cutoff = new QLineEdit(central);
    connect(cutoff, SIGNAL(returnPressed()),
            this, SLOT(cutoffProcessText()));
    mainLayout->addWidget(cutoff, 6,1);

    computeParamValues = new QCheckBox(tr("Output parameter values"), central);
    connect(computeParamValues, SIGNAL(toggled(bool)),
            this, SLOT(computeParamValuesChanged(bool)));
    mainLayout->addWidget(computeParamValues, 7,0);

    computeCovariates = new QCheckBox(tr("Compute covariates"), central);
    connect(computeCovariates, SIGNAL(toggled(bool)),
            this, SLOT(computeCovariatesChanged(bool)));
    mainLayout->addWidget(computeCovariates, 8,0);

    covariateReturnYearsLabel = new QLabel(tr("Covariate return years"), central);
    mainLayout->addWidget(covariateReturnYearsLabel,9,0);
    covariateReturnYears = new QLineEdit(central);
    connect(covariateReturnYears, SIGNAL(returnPressed()),
            this, SLOT(covariateReturnYearsProcessText()));
    mainLayout->addWidget(covariateReturnYears, 9,1);

    covariateModelLocation = new QCheckBox(tr("Covariate Location Model"), central);
    connect(covariateModelLocation, SIGNAL(toggled(bool)),
            this, SLOT(covariateModelLocationChanged(bool)));
    mainLayout->addWidget(covariateModelLocation, 10,0);

    covariateModelShape = new QCheckBox(tr("Covariate Shape Model"), central);
    connect(covariateModelShape, SIGNAL(toggled(bool)),
            this, SLOT(covariateModelShapeChanged(bool)));
    mainLayout->addWidget(covariateModelShape, 11,0);

    covariateModelScale = new QCheckBox(tr("Covariate Scale Model"), central);
    connect(covariateModelScale, SIGNAL(toggled(bool)),
            this, SLOT(covariateModelScaleChanged(bool)));
    mainLayout->addWidget(covariateModelScale, 12,0);

    computeRVDifferences = new QCheckBox(tr("Compute RV differences"), central);
    connect(computeRVDifferences, SIGNAL(toggled(bool)),
            this, SLOT(computeRVDifferencesChanged(bool)));
    mainLayout->addWidget(computeRVDifferences, 13,0);

    rvDifferencesLabel = new QLabel(tr("RV Differences"), central);
    mainLayout->addWidget(rvDifferencesLabel,14,0);
    rvDifferences = new QLineEdit(central);
    connect(rvDifferences, SIGNAL(returnPressed()),
            this, SLOT(rvDifferencesProcessText()));
    mainLayout->addWidget(rvDifferences, 14,1);

    dataScalingLabel = new QLabel(tr("Data Scaling"), central);
    mainLayout->addWidget(dataScalingLabel,15,0);
    dataScaling = new QLineEdit(central);
    connect(dataScaling, SIGNAL(returnPressed()),
            this, SLOT(dataScalingProcessText()));
    mainLayout->addWidget(dataScaling, 15,1);

    dumpData = new QCheckBox(tr("Dump Data"), central);
    connect(dumpData, SIGNAL(toggled(bool)),
            this, SLOT(dumpDataChanged(bool)));
    mainLayout->addWidget(dumpData, 16,0);

}


// ****************************************************************************
// Method: QvisPeaksOverThresholdWindow::UpdateWindow
//
// Purpose: 
//   Updates the widgets in the window when the subject changes.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisPeaksOverThresholdWindow::UpdateWindow(bool doAll)
{

    for(int i = 0; i < atts->NumAttributes(); ++i)
    {
        if(!doAll)
        {
            if(!atts->IsSelected(i))
            {
                continue;
            }
        }

        switch(i)
        {
          case PeaksOverThresholdAttributes::ID_aggregation:
            if (atts->GetAggregation() == PeaksOverThresholdAttributes::ANNUAL)
            {
                annualPercentile->setEnabled(true);
                if(annualPercentileLabel)
                    annualPercentileLabel->setEnabled(true);
            }
            else
            {
                annualPercentile->setEnabled(false);
                if(annualPercentileLabel)
                    annualPercentileLabel->setEnabled(false);
            }
            if (atts->GetAggregation() == PeaksOverThresholdAttributes::SEASONAL)
            {
                seasonalPercentile->setEnabled(true);
                if(seasonalPercentileLabel)
                    seasonalPercentileLabel->setEnabled(true);
            }
            else
            {
                seasonalPercentile->setEnabled(false);
                if(seasonalPercentileLabel)
                    seasonalPercentileLabel->setEnabled(false);
            }
            if (atts->GetAggregation() == PeaksOverThresholdAttributes::MONTHLY)
            {
                monthlyPercentile->setEnabled(true);
                if(monthlyPercentileLabel)
                    monthlyPercentileLabel->setEnabled(true);
            }
            else
            {
                monthlyPercentile->setEnabled(false);
                if(monthlyPercentileLabel)
                    monthlyPercentileLabel->setEnabled(false);
            }
            if (atts->GetAggregation() == PeaksOverThresholdAttributes::SEASONAL)
            {
                displaySeason->setEnabled(true);
                if(displaySeasonLabel)
                    displaySeasonLabel->setEnabled(true);
            }
            else
            {
                displaySeason->setEnabled(false);
                if(displaySeasonLabel)
                    displaySeasonLabel->setEnabled(false);
            }
            if (atts->GetAggregation() == PeaksOverThresholdAttributes::MONTHLY)
            {
                displayMonth->setEnabled(true);
                if(displayMonthLabel)
                    displayMonthLabel->setEnabled(true);
            }
            else
            {
                displayMonth->setEnabled(false);
                if(displayMonthLabel)
                    displayMonthLabel->setEnabled(false);
            }
            aggregationButtonGroup->blockSignals(true);
            if(aggregationButtonGroup->button((int)atts->GetAggregation()) != 0)
                aggregationButtonGroup->button((int)atts->GetAggregation())->setChecked(true);
            aggregationButtonGroup->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_annualPercentile:
            annualPercentile->setText(DoubleToQString(atts->GetAnnualPercentile()));
            break;
          case PeaksOverThresholdAttributes::ID_seasonalPercentile:
            seasonalPercentile->setText(DoublesToQString(atts->GetSeasonalPercentile(), 4));
            break;
          case PeaksOverThresholdAttributes::ID_monthlyPercentile:
            monthlyPercentile->setText(DoublesToQString(atts->GetMonthlyPercentile(), 12));
            break;
          case PeaksOverThresholdAttributes::ID_displaySeason:
            displaySeasonButtonGroup->blockSignals(true);
            if(displaySeasonButtonGroup->button((int)atts->GetDisplaySeason()) != 0)
                displaySeasonButtonGroup->button((int)atts->GetDisplaySeason())->setChecked(true);
            displaySeasonButtonGroup->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_displayMonth:
            displayMonthButtonGroup->blockSignals(true);
            if(displayMonthButtonGroup->button((int)atts->GetDisplayMonth()) != 0)
                displayMonthButtonGroup->button((int)atts->GetDisplayMonth())->setChecked(true);
            displayMonthButtonGroup->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_cutoff:
            cutoff->setText(FloatToQString(atts->GetCutoff()));
            break;
          case PeaksOverThresholdAttributes::ID_computeParamValues:
            computeParamValues->blockSignals(true);
            computeParamValues->setChecked(atts->GetComputeParamValues());
            computeParamValues->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_computeCovariates:
            if (atts->GetComputeCovariates() == true)
            {
                covariateReturnYears->setEnabled(true);
                if(covariateReturnYearsLabel)
                    covariateReturnYearsLabel->setEnabled(true);
            }
            else
            {
                covariateReturnYears->setEnabled(false);
                if(covariateReturnYearsLabel)
                    covariateReturnYearsLabel->setEnabled(false);
            }
            if (atts->GetComputeCovariates() == true)
            {
                covariateModelLocation->setEnabled(true);
            }
            else
            {
                covariateModelLocation->setEnabled(false);
            }
            if (atts->GetComputeCovariates() == true)
            {
                covariateModelShape->setEnabled(true);
            }
            else
            {
                covariateModelShape->setEnabled(false);
            }
            if (atts->GetComputeCovariates() == true)
            {
                covariateModelScale->setEnabled(true);
            }
            else
            {
                covariateModelScale->setEnabled(false);
            }
            if (atts->GetComputeCovariates() == true)
            {
                computeRVDifferences->setEnabled(true);
            }
            else
            {
                computeRVDifferences->setEnabled(false);
            }
            computeCovariates->blockSignals(true);
            computeCovariates->setChecked(atts->GetComputeCovariates());
            computeCovariates->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_covariateReturnYears:
            covariateReturnYears->setText(IntsToQString(atts->GetCovariateReturnYears()));
            break;
          case PeaksOverThresholdAttributes::ID_covariateModelLocation:
            covariateModelLocation->blockSignals(true);
            covariateModelLocation->setChecked(atts->GetCovariateModelLocation());
            covariateModelLocation->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_covariateModelShape:
            covariateModelShape->blockSignals(true);
            covariateModelShape->setChecked(atts->GetCovariateModelShape());
            covariateModelShape->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_covariateModelScale:
            covariateModelScale->blockSignals(true);
            covariateModelScale->setChecked(atts->GetCovariateModelScale());
            covariateModelScale->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_computeRVDifferences:
            if (atts->GetComputeRVDifferences() == true)
            {
                rvDifferences->setEnabled(true);
                if(rvDifferencesLabel)
                    rvDifferencesLabel->setEnabled(true);
            }
            else
            {
                rvDifferences->setEnabled(false);
                if(rvDifferencesLabel)
                    rvDifferencesLabel->setEnabled(false);
            }
            computeRVDifferences->blockSignals(true);
            computeRVDifferences->setChecked(atts->GetComputeRVDifferences());
            computeRVDifferences->blockSignals(false);
            break;
          case PeaksOverThresholdAttributes::ID_rvDifferences:
            rvDifferences->setText(IntsToQString(atts->GetRvDifferences(),2));
            break;
          case PeaksOverThresholdAttributes::ID_dataScaling:
            dataScaling->setText(DoubleToQString(atts->GetDataScaling()));
            break;
          case PeaksOverThresholdAttributes::ID_dumpData:
            dumpData->blockSignals(true);
            dumpData->setChecked(atts->GetDumpData());
            dumpData->blockSignals(false);
            break;
        }
    }
}


// ****************************************************************************
// Method: QvisPeaksOverThresholdWindow::GetCurrentValues
//
// Purpose: 
//   Gets values from certain widgets and stores them in the subject.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisPeaksOverThresholdWindow::GetCurrentValues(int which_widget)
{
    bool doAll = (which_widget == -1);

    // Do annualPercentile
    if(which_widget == PeaksOverThresholdAttributes::ID_annualPercentile || doAll)
    {
        double val;
        if(LineEditGetDouble(annualPercentile, val))
            atts->SetAnnualPercentile(val);
        else
        {
            ResettingError(tr("Annual Percentile"),
                DoubleToQString(atts->GetAnnualPercentile()));
            atts->SetAnnualPercentile(atts->GetAnnualPercentile());
        }
    }

    // Do seasonalPercentile
    if(which_widget == PeaksOverThresholdAttributes::ID_seasonalPercentile || doAll)
    {
        double val[4];
        if(LineEditGetDoubles(seasonalPercentile, val, 4))
            atts->SetSeasonalPercentile(val);
        else
        {
            ResettingError(tr("Seasonal Percentile"),
                DoublesToQString(atts->GetSeasonalPercentile(),4));
            atts->SetSeasonalPercentile(atts->GetSeasonalPercentile());
        }
    }

    // Do monthlyPercentile
    if(which_widget == PeaksOverThresholdAttributes::ID_monthlyPercentile || doAll)
    {
        double val[12];
        if(LineEditGetDoubles(monthlyPercentile, val, 12))
            atts->SetMonthlyPercentile(val);
        else
        {
            ResettingError(tr("Monthly Percentile"),
                DoublesToQString(atts->GetMonthlyPercentile(),12));
            atts->SetMonthlyPercentile(atts->GetMonthlyPercentile());
        }
    }

    // Do cutoff
    if(which_widget == PeaksOverThresholdAttributes::ID_cutoff || doAll)
    {
        float val;
        if(LineEditGetFloat(cutoff, val))
            atts->SetCutoff(val);
        else
        {
            ResettingError(tr("Cutoff"),
                FloatToQString(atts->GetCutoff()));
            atts->SetCutoff(atts->GetCutoff());
        }
    }

    // Do covariateReturnYears
    if(which_widget == PeaksOverThresholdAttributes::ID_covariateReturnYears || doAll)
    {
        intVector val;
        if(LineEditGetInts(covariateReturnYears, val))
            atts->SetCovariateReturnYears(val);
        else
        {
            ResettingError(tr("Covariate return years"),
                IntsToQString(atts->GetCovariateReturnYears()));
            atts->SetCovariateReturnYears(atts->GetCovariateReturnYears());
        }
    }

    // Do rvDifferences
    if(which_widget == PeaksOverThresholdAttributes::ID_rvDifferences || doAll)
    {
        int val[2];
        if(LineEditGetInts(rvDifferences, val, 2))
            atts->SetRvDifferences(val);
        else
        {
            ResettingError(tr("RV Differences"),
                IntsToQString(atts->GetRvDifferences(), 2));
            atts->SetRvDifferences(atts->GetRvDifferences());
        }
    }

    // Do dataScaling
    if(which_widget == PeaksOverThresholdAttributes::ID_dataScaling || doAll)
    {
        double val;
        if(LineEditGetDouble(dataScaling, val))
            atts->SetDataScaling(val);
        else
        {
            ResettingError(tr("Data Scaling"),
                DoubleToQString(atts->GetDataScaling()));
            atts->SetDataScaling(atts->GetDataScaling());
        }
    }

}


//
// Qt Slot functions
//


void
QvisPeaksOverThresholdWindow::aggregationChanged(int val)
{
    if(val != atts->GetAggregation())
    {
        atts->SetAggregation(PeaksOverThresholdAttributes::AggregationType(val));
        Apply();
    }
}


void
QvisPeaksOverThresholdWindow::annualPercentileProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_annualPercentile);
    Apply();
}


void
QvisPeaksOverThresholdWindow::seasonalPercentileProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_seasonalPercentile);
    Apply();
}


void
QvisPeaksOverThresholdWindow::monthlyPercentileProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_monthlyPercentile);
    Apply();
}


void
QvisPeaksOverThresholdWindow::displaySeasonChanged(int val)
{
    if(val != atts->GetDisplaySeason())
    {
        atts->SetDisplaySeason(PeaksOverThresholdAttributes::SeasonType(val));
        SetUpdate(false);
        Apply();
    }
}


void
QvisPeaksOverThresholdWindow::displayMonthChanged(int val)
{
    if(val != atts->GetDisplayMonth())
    {
        atts->SetDisplayMonth(PeaksOverThresholdAttributes::MonthType(val));
        SetUpdate(false);
        Apply();
    }
}


void
QvisPeaksOverThresholdWindow::cutoffProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_cutoff);
    Apply();
}


void
QvisPeaksOverThresholdWindow::computeParamValuesChanged(bool val)
{
    atts->SetComputeParamValues(val);
    SetUpdate(false);
    Apply();
}


void
QvisPeaksOverThresholdWindow::computeCovariatesChanged(bool val)
{
    atts->SetComputeCovariates(val);
    Apply();
}


void
QvisPeaksOverThresholdWindow::covariateReturnYearsProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_covariateReturnYears);
    Apply();
}


void
QvisPeaksOverThresholdWindow::covariateModelLocationChanged(bool val)
{
    atts->SetCovariateModelLocation(val);
    SetUpdate(false);
    Apply();
}


void
QvisPeaksOverThresholdWindow::covariateModelShapeChanged(bool val)
{
    atts->SetCovariateModelShape(val);
    SetUpdate(false);
    Apply();
}


void
QvisPeaksOverThresholdWindow::covariateModelScaleChanged(bool val)
{
    atts->SetCovariateModelScale(val);
    SetUpdate(false);
    Apply();
}


void
QvisPeaksOverThresholdWindow::computeRVDifferencesChanged(bool val)
{
    atts->SetComputeRVDifferences(val);
    Apply();
}


void
QvisPeaksOverThresholdWindow::rvDifferencesProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_rvDifferences);
    Apply();
}


void
QvisPeaksOverThresholdWindow::dataScalingProcessText()
{
    GetCurrentValues(PeaksOverThresholdAttributes::ID_dataScaling);
    Apply();
}


void
QvisPeaksOverThresholdWindow::dumpDataChanged(bool val)
{
    atts->SetDumpData(val);
    SetUpdate(false);
    Apply();
}


