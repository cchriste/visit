/*****************************************************************************
*
* Copyright (c) 2000 - 2012, Lawrence Livermore National Security, LLC
* Produced at the Lawrence Livermore National Laboratory
* LLNL-CODE-442911
* All rights reserved.
*
* This file is  part of VisIt. For  details, see https://visit.llnl.gov/.  The
* full copyright notice is contained in the file COPYRIGHT located at the root
* of the VisIt distribution or at http://www.llnl.gov/visit/copyright.html.
*
* Redistribution  and  use  in  source  and  binary  forms,  with  or  without
* modification, are permitted provided that the following conditions are met:
*
*  - Redistributions of  source code must  retain the above  copyright notice,
*    this list of conditions and the disclaimer below.
*  - Redistributions in binary form must reproduce the above copyright notice,
*    this  list of  conditions  and  the  disclaimer (as noted below)  in  the
*    documentation and/or other materials provided with the distribution.
*  - Neither the name of  the LLNS/LLNL nor the names of  its contributors may
*    be used to endorse or promote products derived from this software without
*    specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT  HOLDERS AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR  IMPLIED WARRANTIES, INCLUDING,  BUT NOT  LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS FOR A PARTICULAR  PURPOSE
* ARE  DISCLAIMED. IN  NO EVENT  SHALL LAWRENCE  LIVERMORE NATIONAL  SECURITY,
* LLC, THE  U.S.  DEPARTMENT OF  ENERGY  OR  CONTRIBUTORS BE  LIABLE  FOR  ANY
* DIRECT,  INDIRECT,   INCIDENTAL,   SPECIAL,   EXEMPLARY,  OR   CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT  LIMITED TO, PROCUREMENT OF  SUBSTITUTE GOODS OR
* SERVICES; LOSS OF  USE, DATA, OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER
* CAUSED  AND  ON  ANY  THEORY  OF  LIABILITY,  WHETHER  IN  CONTRACT,  STRICT
* LIABILITY, OR TORT  (INCLUDING NEGLIGENCE OR OTHERWISE)  ARISING IN ANY  WAY
* OUT OF THE  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
* DAMAGE.
*
*****************************************************************************/

#include "QvisExtremeValueAnalysisWindow.h"

#include <ExtremeValueAnalysisAttributes.h>
#include <ViewerProxy.h>

#include <QCheckBox>
#include <QLabel>
#include <QLayout>
#include <QLineEdit>
#include <QSpinBox>
#include <QButtonGroup>
#include <QRadioButton>
#include <QvisColorTableButton.h>
#include <QvisOpacitySlider.h>
#include <QvisColorButton.h>
#include <QvisLineStyleWidget.h>
#include <QvisLineWidthWidget.h>
#include <QvisVariableButton.h>

#include <stdio.h>
#include <string>

using std::string;

// ****************************************************************************
// Method: QvisExtremeValueAnalysisWindow::QvisExtremeValueAnalysisWindow
//
// Purpose: 
//   Constructor
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

QvisExtremeValueAnalysisWindow::QvisExtremeValueAnalysisWindow(const int type,
                         ExtremeValueAnalysisAttributes *subj,
                         const QString &caption,
                         const QString &shortName,
                         QvisNotepadArea *notepad)
    : QvisOperatorWindow(type,subj, caption, shortName, notepad)
{
    atts = subj;
}


// ****************************************************************************
// Method: QvisExtremeValueAnalysisWindow::~QvisExtremeValueAnalysisWindow
//
// Purpose: 
//   Destructor
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

QvisExtremeValueAnalysisWindow::~QvisExtremeValueAnalysisWindow()
{
}


// ****************************************************************************
// Method: QvisExtremeValueAnalysisWindow::CreateWindowContents
//
// Purpose: 
//   Creates the widgets for the window.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisExtremeValueAnalysisWindow::CreateWindowContents()
{
    QGridLayout *mainLayout = new QGridLayout(0);
    topLayout->addLayout(mainLayout);

    aggregationLabel = new QLabel(tr("Aggregation"), central);
    mainLayout->addWidget(aggregationLabel,0,0);
    aggregation = new QWidget(central);
    aggregationButtonGroup= new QButtonGroup(aggregation);
    QHBoxLayout *aggregationLayout = new QHBoxLayout(aggregation);
    aggregationLayout->setMargin(0);
    aggregationLayout->setSpacing(10);
    QRadioButton *aggregationAggregationTypeANNUAL = new QRadioButton(tr("ANNUAL"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeANNUAL,0);
    aggregationLayout->addWidget(aggregationAggregationTypeANNUAL);
    QRadioButton *aggregationAggregationTypeMONTHLY = new QRadioButton(tr("MONTHLY"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeMONTHLY,1);
    aggregationLayout->addWidget(aggregationAggregationTypeMONTHLY);
    QRadioButton *aggregationAggregationTypeSEASONAL = new QRadioButton(tr("SEASONAL"), aggregation);
    aggregationButtonGroup->addButton(aggregationAggregationTypeSEASONAL,2);
    aggregationLayout->addWidget(aggregationAggregationTypeSEASONAL);
    connect(aggregationButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(aggregationChanged(int)));
    mainLayout->addWidget(aggregation, 0,1);

    displayMonthLabel = new QLabel(tr("Display Month"), central);
    mainLayout->addWidget(displayMonthLabel,1,0);
    displayMonth = new QWidget(central);
    displayMonthButtonGroup= new QButtonGroup(displayMonth);
    QHBoxLayout *displayMonthLayout = new QHBoxLayout(displayMonth);
    displayMonthLayout->setMargin(0);
    displayMonthLayout->setSpacing(10);
    QRadioButton *displayMonthMonthTypeJanuary = new QRadioButton(tr("January"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJanuary,0);
    displayMonthLayout->addWidget(displayMonthMonthTypeJanuary);
    QRadioButton *displayMonthMonthTypeFebruary = new QRadioButton(tr("February"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeFebruary,1);
    displayMonthLayout->addWidget(displayMonthMonthTypeFebruary);
    QRadioButton *displayMonthMonthTypeMarch = new QRadioButton(tr("March"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeMarch,2);
    displayMonthLayout->addWidget(displayMonthMonthTypeMarch);
    QRadioButton *displayMonthMonthTypeApril = new QRadioButton(tr("April"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeApril,3);
    displayMonthLayout->addWidget(displayMonthMonthTypeApril);
    QRadioButton *displayMonthMonthTypeMay = new QRadioButton(tr("May"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeMay,4);
    displayMonthLayout->addWidget(displayMonthMonthTypeMay);
    QRadioButton *displayMonthMonthTypeJune = new QRadioButton(tr("June"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJune,5);
    displayMonthLayout->addWidget(displayMonthMonthTypeJune);
    QRadioButton *displayMonthMonthTypeJuly = new QRadioButton(tr("July"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeJuly,6);
    displayMonthLayout->addWidget(displayMonthMonthTypeJuly);
    QRadioButton *displayMonthMonthTypeAugust = new QRadioButton(tr("August"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeAugust,7);
    displayMonthLayout->addWidget(displayMonthMonthTypeAugust);
    QRadioButton *displayMonthMonthTypeSeptember = new QRadioButton(tr("September"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeSeptember,8);
    displayMonthLayout->addWidget(displayMonthMonthTypeSeptember);
    QRadioButton *displayMonthMonthTypeOctober = new QRadioButton(tr("October"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeOctober,9);
    displayMonthLayout->addWidget(displayMonthMonthTypeOctober);
    QRadioButton *displayMonthMonthTypeNovember = new QRadioButton(tr("November"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeNovember,10);
    displayMonthLayout->addWidget(displayMonthMonthTypeNovember);
    QRadioButton *displayMonthMonthTypeDecember = new QRadioButton(tr("December"), displayMonth);
    displayMonthButtonGroup->addButton(displayMonthMonthTypeDecember,11);
    displayMonthLayout->addWidget(displayMonthMonthTypeDecember);
    connect(displayMonthButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(displayMonthChanged(int)));
    mainLayout->addWidget(displayMonth, 1,1);

    displaySeasonLabel = new QLabel(tr("Display Season"), central);
    mainLayout->addWidget(displaySeasonLabel,2,0);
    displaySeason = new QWidget(central);
    displaySeasonButtonGroup= new QButtonGroup(displaySeason);
    QHBoxLayout *displaySeasonLayout = new QHBoxLayout(displaySeason);
    displaySeasonLayout->setMargin(0);
    displaySeasonLayout->setSpacing(10);
    QRadioButton *displaySeasonSeasonTypeWINTER = new QRadioButton(tr("WINTER"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeWINTER,0);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeWINTER);
    QRadioButton *displaySeasonSeasonTypeSPRING = new QRadioButton(tr("SPRING"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeSPRING,1);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeSPRING);
    QRadioButton *displaySeasonSeasonTypeSUMMER = new QRadioButton(tr("SUMMER"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeSUMMER,2);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeSUMMER);
    QRadioButton *displaySeasonSeasonTypeFALL = new QRadioButton(tr("FALL"), displaySeason);
    displaySeasonButtonGroup->addButton(displaySeasonSeasonTypeFALL,3);
    displaySeasonLayout->addWidget(displaySeasonSeasonTypeFALL);
    connect(displaySeasonButtonGroup, SIGNAL(buttonClicked(int)),
            this, SLOT(displaySeasonChanged(int)));
    mainLayout->addWidget(displaySeason, 2,1);

    dumpData = new QCheckBox(tr("Dump Data"), central);
    connect(dumpData, SIGNAL(toggled(bool)),
            this, SLOT(dumpDataChanged(bool)));
    mainLayout->addWidget(dumpData, 3,0);

    dataScalingLabel = new QLabel(tr("Data Scaling"), central);
    mainLayout->addWidget(dataScalingLabel,4,0);
    dataScaling = new QLineEdit(central);
    connect(dataScaling, SIGNAL(returnPressed()),
            this, SLOT(dataScalingProcessText()));
    mainLayout->addWidget(dataScaling, 4,1);

}


// ****************************************************************************
// Method: QvisExtremeValueAnalysisWindow::UpdateWindow
//
// Purpose: 
//   Updates the widgets in the window when the subject changes.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisExtremeValueAnalysisWindow::UpdateWindow(bool doAll)
{

    for(int i = 0; i < atts->NumAttributes(); ++i)
    {
        if(!doAll)
        {
            if(!atts->IsSelected(i))
            {
                continue;
            }
        }

        switch(i)
        {
          case ExtremeValueAnalysisAttributes::ID_aggregation:
            if (atts->GetAggregation() == ExtremeValueAnalysisAttributes::MONTHLY)
            {
                displayMonth->setEnabled(true);
                if(displayMonthLabel)
                    displayMonthLabel->setEnabled(true);
            }
            else
            {
                displayMonth->setEnabled(false);
                if(displayMonthLabel)
                    displayMonthLabel->setEnabled(false);
            }
            if (atts->GetAggregation() == ExtremeValueAnalysisAttributes::SEASONAL)
            {
                displaySeason->setEnabled(true);
                if(displaySeasonLabel)
                    displaySeasonLabel->setEnabled(true);
            }
            else
            {
                displaySeason->setEnabled(false);
                if(displaySeasonLabel)
                    displaySeasonLabel->setEnabled(false);
            }
            aggregationButtonGroup->blockSignals(true);
            if(aggregationButtonGroup->button((int)atts->GetAggregation()) != 0)
                aggregationButtonGroup->button((int)atts->GetAggregation())->setChecked(true);
            aggregationButtonGroup->blockSignals(false);
            break;
          case ExtremeValueAnalysisAttributes::ID_displayMonth:
            displayMonthButtonGroup->blockSignals(true);
            if(displayMonthButtonGroup->button((int)atts->GetDisplayMonth()) != 0)
                displayMonthButtonGroup->button((int)atts->GetDisplayMonth())->setChecked(true);
            displayMonthButtonGroup->blockSignals(false);
            break;
          case ExtremeValueAnalysisAttributes::ID_displaySeason:
            displaySeasonButtonGroup->blockSignals(true);
            if(displaySeasonButtonGroup->button((int)atts->GetDisplaySeason()) != 0)
                displaySeasonButtonGroup->button((int)atts->GetDisplaySeason())->setChecked(true);
            displaySeasonButtonGroup->blockSignals(false);
            break;
          case ExtremeValueAnalysisAttributes::ID_dumpData:
            dumpData->blockSignals(true);
            dumpData->setChecked(atts->GetDumpData());
            dumpData->blockSignals(false);
            break;
          case ExtremeValueAnalysisAttributes::ID_dataScaling:
            dataScaling->setText(DoubleToQString(atts->GetDataScaling()));
            break;
        }
    }
}


// ****************************************************************************
// Method: QvisExtremeValueAnalysisWindow::GetCurrentValues
//
// Purpose: 
//   Gets values from certain widgets and stores them in the subject.
//
// Note:       Autogenerated by xml2window.
//
// Programmer: xml2window
// Creation:   omitted
//
// Modifications:
//   
// ****************************************************************************

void
QvisExtremeValueAnalysisWindow::GetCurrentValues(int which_widget)
{
    bool doAll = (which_widget == -1);

    // Do dataScaling
    if(which_widget == ExtremeValueAnalysisAttributes::ID_dataScaling || doAll)
    {
        double val;
        if(LineEditGetDouble(dataScaling, val))
            atts->SetDataScaling(val);
        else
        {
            ResettingError(tr("Data Scaling"),
                DoubleToQString(atts->GetDataScaling()));
            atts->SetDataScaling(atts->GetDataScaling());
        }
    }

}


//
// Qt Slot functions
//


void
QvisExtremeValueAnalysisWindow::aggregationChanged(int val)
{
    if(val != atts->GetAggregation())
    {
        atts->SetAggregation(ExtremeValueAnalysisAttributes::AggregationType(val));
        Apply();
    }
}


void
QvisExtremeValueAnalysisWindow::displayMonthChanged(int val)
{
    if(val != atts->GetDisplayMonth())
    {
        atts->SetDisplayMonth(ExtremeValueAnalysisAttributes::MonthType(val));
        SetUpdate(false);
        Apply();
    }
}


void
QvisExtremeValueAnalysisWindow::displaySeasonChanged(int val)
{
    if(val != atts->GetDisplaySeason())
    {
        atts->SetDisplaySeason(ExtremeValueAnalysisAttributes::SeasonType(val));
        SetUpdate(false);
        Apply();
    }
}


void
QvisExtremeValueAnalysisWindow::dumpDataChanged(bool val)
{
    atts->SetDumpData(val);
    SetUpdate(false);
    Apply();
}


void
QvisExtremeValueAnalysisWindow::dataScalingProcessText()
{
    GetCurrentValues(ExtremeValueAnalysisAttributes::ID_dataScaling);
    Apply();
}


