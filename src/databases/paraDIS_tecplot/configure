#!/usr/bin/env bash
debug=
if [ x$1 == x-debug ] ; then
    debug=1
    shift
fi
if [ x"$1" != x ]; then 
    visit_version=" -v $1 "
else
    visit_version=
fi

if ! . $(dirname $0)/shellfuncs.sh ; then 
    echo ERROR cannot source shellfuncs.sh
    exit 1
fi

rm -f Makefile
xml2makefile $visit_version -clobber paraDIS_tecplot.xml
xml2info $visit_version -clobber paraDIS_tecplot.xml
mv Makefile Makefile.${SYS_TYPE}
makevarsfile=($(grep make-variables Makefile.${SYS_TYPE}))
makevarsfile=${makevarsfile[1]}
sedfiles "s:$makevarsfile:make-variables.$SYS_TYPE:" Makefile.${SYS_TYPE}
cp $makevarsfile make-variables.$SYS_TYPE
if nonnull $debug; then    
    runecho sedfiles 's/-O2/-g/g'  make-variables.$SYS_TYPE
    touch DEBUG_ENABLED
else
    rm -f DEBUG_ENABLED
fi
ln -s Makefile.master Makefile
