#                         Copyright (c) 2000 - 2008
#                  Lawrence Livermore National Security, LLC
#            Produced at the Lawrence Livermore National Laboratory
#                              LLNL-CODE-400124
#                            All rights reserved.
#
# This file is  part of VisIt. For  details, see https://visit.llnl.gov/.  The
# full copyright notice is contained in the file COPYRIGHT located at the root
# of the VisIt distribution or at https://visit.llnl.gov/copyright.html.
#
# Redistribution  and  use  in  source  and  binary  forms,  with  or  without
# modification, are permitted provided  that the following conditions are met:
#
# - Redistributions of  source code  must retain  the above  copyright notice,
#   this list of conditions and the disclaimer below.
# - Redistributions in binary form must  reproduce the above copyright notice,
#   this  list of  conditions  and  the  disclaimer  (as noted below)  in  the
#   documentation and/or other materials provided with the distribution.
# - Neither the name of the LLNS/LLNL nor the names of its contributors may be
#   used to endorse  or promote products  derived from  this software  without
#   specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE  COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR  IMPLIED WARRANTIES,  INCLUDING, BUT NOT  LIMITED TO, THE
# IMPLIED WARRANTIES  OF MERCHANTABILITY AND FITNESS FOR  A PARTICULAR PURPOSE
# ARE  DISCLAIMED. IN  NO EVENT  SHALL LAWRENCE  LIVERMORE NATIONAL  SECURITY,
# LLC, THE  U.S.  DEPARTMENT OF  ENERGY  OR  CONTRIBUTORS BE  LIABLE  FOR  ANY
# DIRECT,  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF  LIABILITY, WHETHER IN CONTRACT, STRICT  LIABILITY, OR TORT
# (INCLUDING  NEGLIGENCE OR  OTHERWISE) ARISING IN ANY  WAY OUT OF  THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# Programmer:  Jeremy Meredith
# Date:        August 21, 2002
#
# Modifications:
#
#   Hank Childs, Thu Oct  3 11:01:23 PDT 2002
#   Add a reader for Tetrad.
#
#   Hank Childs, Sun Oct 13 21:23:52 PDT 2002
#   Added a KullLite reader based on work by Akira Haddox.
#
#   Brad Whitlock, Mon Oct 14 16:34:22 PST 2002
#   Added the PDB reader.
#
#   Sean Ahern, Fri Nov 15 15:20:20 PST 2002
#   Added the ability for some databases to be "optional", just like
#   operators.  Not sure this will be used, but...
#
#   Hank Childs, Tue Mar 11 15:48:01 PST 2003
#   Added Spheral++ reader.  Point of contact is Mike Owen.
#
#   Hank Childs, Sat Mar 15 14:18:02 PST 2003
#   Added Points3D reader.  Point of contact is Bill Moran.
#
#   Jeremy Meredith, Tue Apr  8 13:18:29 PDT 2003
#   Added sample readers Rect and Hex.
#
#   Hank Childs, Fri Apr 11 07:25:27 PDT 2003
#   Added Mili reader.
#
#   Hank Childs, Tue Apr 22 16:19:42 PDT 2003
#   Added EnSight reader.
#
#   Jeremy Meredith, Wed May  7 14:00:19 PDT 2003
#   Removed PDB reader.  It should be added to the "PDB" target class
#   if we want it again.
#
#   Hank Childs, Mon May 12 22:36:20 PDT 2003
#   Added BOV reader.
#
#   Akira Haddox, Thu Jun 12 10:12:47 PDT 2003
#   Added Cosmos reader.
#
#   Eric Brugger, Mon Jun 16 12:57:17 PDT 2003
#   Make the building of the BOV reader optional.
#
#   Hank Childs, Tue Jun 17 10:07:15 PDT 2003
#   Do not require that HDF4 be available.  Modified BOV to depend on ZLIB.
#
#   Eric Brugger, Thu Jul  3 17:15:39 PDT 2003
#   Make the building of the BOV reader required.
#
#   Hank Childs, Mon Aug 11 15:51:54 PDT 2003
#   Add PLOT2D.
#
#   Akira Haddox, Fri Aug  8 10:50:10 PDT 2003
#   Added Boxlib2D, Boxlib3D readers.
#
#   Brad Whitlock, Tue Nov 25 13:50:19 PST 2003
#   Added reader for ANALYZE.
#
#   Hank Childs, Mon Nov 24 09:33:18 PST 2003
#   Added Cosmos++.
#
#   Chris Wojtan, Tue Jun 15 15:46:54 PDT 2004
#   Added Image file format reader.
#
#   Hank Childs, Thu Jun 24 12:46:07 PDT 2004
#   Remove Vista from the required format list to the HDF5 list.
#
#   Mark C. Miller, Wed Jul 21 11:19:15 PDT 2004
#   Added Vista back to required format list since it no longer
#   requires HDF5 in order to build. It can now be built with Silo AND HDF5
#   or with Silo only
#
#   Jeremy Meredith, Wed Jul 21 17:44:55 PDT 2004
#   Added OVERFLOW.  It depends on no other libraries.
#
#   Brad Whitlock, Fri Aug 13 14:29:40 PST 2004
#   Added Pixie.
#
#   Jeremy Meredith, Mon Aug 23 14:54:51 PDT 2004
#   Added the Dune plugin.
#
#   Jeremy Meredith, Wed Aug 25 11:56:21 PDT 2004
#   Added SimDB, needed for simulation support.
#
#   Mark C. Miller, Tue Sep 28 19:57:42 PDT 2004
#   Added ViSUS
#
#   Jeremy Meredith, Fri Dec 10 13:39:08 PST 2004
#   Tools are now run directly instead of as an argument to visit.
# 
#   Jeremy Meredith, Wed Nov 17 11:24:23 PST 2004
#   Added TecPlot.
#
#   Brad Whitlock, Fri Dec 17 13:26:46 PST 2004
#   Added CMAT reader.
#
#   Jeremy Meredith, Mon Jan  3 12:46:10 PST 2005
#   Added Enzo reader, which uses HDF4.  At some point it may also use HDF5.
#
#   Hank Childs, Sun Feb 13 13:35:13 PST 2005
#   Added SAR reader (SAR-> Specific Absorption Rate).
#
#   Jeremy Meredith, February 16, 2005
#   Changed captilization of Tecplot.
#
#   Brad Whitlock, Tue Feb 22 19:22:24 PST 2005
#   Added TFT reader.
#
#   Jeremy Meredith, Thu Mar 10 12:37:54 PST 2005
#   Renamed SimDB to SimV1 to make versioning explicit.
#
#   Brad Whitlock, Tue Mar 29 09:40:08 PDT 2005
#   Added Shapefile reader for ESRI shape files, which are popular in
#   GIS visualization.
#
#   Brad Whitlock, Fri Jun 17 15:03:29 PST 2005
#   Added Mark's AUXFile reader.
#
#   Brad Whitlock, Wed Jul 6 16:04:28 PST 2005
#   Added NASTRAN and ANSYS readers.
#
#   Hank Childs, Wed Jul 20 16:01:09 PDT 2005
#   Add Xmdv reader.
#
#   Brad Whitlock, Thu Jul 28 13:47:03 PST 2005
#   Added PATRAN reader.
#
#   Brad Whitlock, Tue Aug 9 17:42:08 PST 2005
#   Added netCDF support and a reader for it.
#
#   Jeremy Meredith, Tue Aug 23 13:27:44 PDT 2005
#   Added a FLASH reader.
#
#   Brad Whitlock, Tue Aug 30 15:59:31 PST 2005
#   Added a CGNS reader.
#
#   Brad Whitlock, Tue Sep 6 11:37:20 PDT 2005
#   Added a GDAL reader.
#
#   Hank Childs, Tue Dec 13 15:45:32 PST 2005
#   Added Miranda reader.
#
#   Mark C. Miller, Thu Dec 15 07:30:03 PST 2005
#   Temporarily removed Miranda from build
#
#   Brad Whitlock, Fri Jan 13 13:47:09 PST 2006
#   Added ZeusMP reader.
#
#   Hank Childs, Thu Jan 19 09:40:30 PST 2006
#   Added Chombo reader.
#
#   Jeremy Meredith, Wed Mar 22 13:46:20 PST 2006
#   Added ProteinDataBank reader
#
#   Brad Whitlock, Fri Mar 31 14:31:42 PST 2006
#   Added BOW and TSurf readers
#
#   Brad Whitlock, Thu Apr 27 13:16:09 PST 2006
#   Added ORNL points (GTC) format.
#
#   Hank Childs, Fri Jun  9 16:27:50 PDT 2006
#   Added MFIX reader.
#
#   Brad Whitlock, Wed Jul 12 17:26:47 PST 2006
#   Added MM5 reader and Vis5D reader.
#
#   Brad Whitlock, Thu Jul 20 11:54:34 PDT 2006
#   Added FITS reader.
#
#   Jeremy Meredith, Wed Jul 26 17:21:58 EDT 2006
#   Added VASP and CTRL molecular formats.
#
#   Tom Fogal, Fri Sep  1 15:58:15 PDT 2006
#   Added the GGCM reader.
#
#   Hank Childs, Fri Sep  8 14:33:44 PDT 2006
#   Added the Fluent reader (for Brian Dotson and Terry Jordan).
#
#   Brad Whitlock, Thu Nov 9 14:00:40 PST 2006
#   Added SimV1Writer plugin.
#
#   Mark C. Miller, Sun Dec  3 12:20:11 PST 2006
#   Removed reference to SAF
#
#   Dave Bremer, Thu Feb 22 12:03:34 PST 2007
#   Added Miranda RAW reader
#
#   Sean Ahern, Fri Apr  6 09:00:55 PDT 2007
#   Added the S3D reader.
#
#   Brad Whitlock, Thu May 17 13:54:01 PST 2007
#   Added Dyna3D reader.
#
#   Gunther H. Weber, Mon May 21 16:49:55 PDT 2007
#   Added Cristina Siegerist's H5Nimrod plugin
#
#   Gunther H. Weber, Mon May 21 17:35:35 PDT 2007
#   Added Cristina Siegerist's H5Part plugin
#
#   Jeremy Meredith, Tue May 22 11:40:38 EDT 2007
#   Added "MINIMAL" subset of plugins.
#
#   Gunther H. Weber, Tue May 22 10:20:31 PDT 2007
#   Merged Jeremy's last change (Tue May 22 11:40:38 EDT 2007) and my
#   last change (Mon May 21 17:35:35 PDT 2007).
#
#   Hank Childs, Fri May 18 17:37:43 PDT 2007
#   Added ExtrudedVol reader.  This is a special purpose reader/writer for
#   the types of extruded volumes created by the TraceHistory operator.
#
#   Jeremy Meredith, Tue Jun  5 14:15:10 EDT 2007
#   Removed reference to .depend.  Nothing is built in this directory.
#
#   Jeremy Meredith, Thu Jun 14 13:39:01 EDT 2007
#   Added XYZ molecular file format.
#
#   Dave Bremer, Thu Jun 14 20:15:04 PDT 2007
#   Added Nek3D reader.
#
#   Dave Bremer, Fri Aug  3 12:03:21 PDT 2007
#   Added SAS reader.
#
#   Brad Whitlock, Thu Aug 2 14:58:05 PST 2007
#   Added CCM reader.
#
#   Mark C. Miller, Sun Aug  5 12:59:23 PDT 2007
#   Added ZipWrapper plugin
#
#   Jeremy Meredith, Thu Aug 30 12:58:48 EDT 2007
#   The distclean should not reference the clean target here since
#   we're descending into subdirectories; this would mean the clean
#   target gets executed for all directories, then the distclean target
#   for all directories.  We just want the latter, so I copied the
#   non-subdir referencing stuff from the clean target to distclean.
#
#   Jeremy Meredith, Thu Sep  6 16:50:53 EDT 2007
#   Having all thirdparty-dependent in ALLSUBDIRS is useless: we wind up
#   generating a Makefile for a directory that we know we will not be
#   able to build.  And, in fact, we cannot even generate dependencies for
#   it since we don't even have include files, and as such, even a make
#   distclean will fail.  Thus, I changed ALLSUBDIRS to ignore third-party-
#   dependent libraries we cannot build.
#   Also, use ALLSUBDIRS for distclean.
#
#   Brad Whitlock, Sat Sep 29 15:26:06 PST 2007
#   Added RAW reader/writer.
#
#   Eric Brugger, Tue Oct  9 08:29:26 PDT 2007
#   Added DDCMD reader.
#
#   Kathleen Bonnell, Fri Oct 12 09:56:21 PDT 2007
#   Added Cale reader.
#
#   Jeremy Meredith, Wed Oct 17 16:26:42 EDT 2007
#   Made the simulation plugins dependent on a variable determined during
#   configure, like the 3rd-party-dependent plugins.
#
#   Eric Brugger, Mon Jan  7 11:55:46 PST 2008
#   Added XDMF reader.
#
#   Hank Childs, Tue Jan  8 13:43:59 PST 2008
#   Move XDMF to HDF5 section.
#
#   Jeremy Meredith, Thu Jan 24 15:40:17 EST 2008
#   Added PlainText.
#
#   Hank Childs, Sun Feb 10 19:43:59 MST 2008
#   Added StreamGhostTest.
#
#   Hank Childs, Wed Feb 13 11:23:51 PST 2008
#   Added AugDecomp.
#
#   Hank Childs, Mon Mar 10 20:16:32 PDT 2008
#   Added CEAucd, based on reader by Thierry Carard.
#   
#   Sean Ahern, Thu May 15 13:13:25 EDT 2008
#   Added initial version of PFLOTRAN reader.
#
#   Hank Childs, Mon Jul  7 07:00:47 PDT 2008
#   Added UNIC.
#
#   Mark C. Miller, Thu Sep 18 14:42:10 PDT 2008
#   Added logic to clean ITAPS_ dir copies created during configure
#   for different ITAPS implementations taking care not to remove something
#   someone may have been inadvertently editing or to remove the true
#   source in the ITAPS_C directory.
#
#   Brad Whitlock, Wed Oct 29 15:13:15 PDT 2008
#   Added Ralph Bruckschen's Gadget 2.0 reader.
#
#   Hank Childs, Mon Jan  5 12:09:16 CST 2009
#   Add Nek5000 reader.
#
#   Hank Childs, Tue Jan 27 08:45:57 PST 2009
#   Added FastBit category.
#
#   Hank Childs, Tue Jan 27 10:36:10 PST 2009
#   Added Prabhat's HDF_UC reader.
#
#   Mark C. Miller, Mon Mar  9 18:43:49 PDT 2009
#   Removed the Dune plugin. It contained some large data files, probably
#   samples that should have been put in data dir instead. But, it was easier
#   just to remove the plugin entirely. And, I don't think anyone has been
#   using it for a while.
#
#   Mark C. Miller, Thu Mar 12 09:20:07 PDT 2009
#   Added dirmakefiles_dbio_only target
#
#   Jeremy Meredith, Fri Mar 13 12:49:47 EDT 2009
#   Added MatrixMarket reader. ( http://math.nist.gov/MatrixMarket/ )
#
#   Sean Ahern, Fri Mar 20 14:07:16 EDT 2009
#   Enzo won't link without HDF5, so it must have HDF5 dependencies.  Moved it
#   to the HDF5 target.
#
#   Mark C. Miller, Fri Mar 20 16:14:23 PST 2009
#   Putting Enzo in HDF5 breaks HDF5-only builds, where HDF4 is NOT present.
#   Since visit-config.h defines HAVE_LIBHDF5, HDF5 dependencies can be
#   dealt with via conditional compilation in Enzo plugin itself. So, Enzo
#   is moved back to HDF4 targets. Enzo REQUIRES HDF4 and, if HDF5 is present
#   will also use that. But, if HDF4 is NOT present, Enzo will NOT be built
#   and that is current best behavior.
#
#   Hank Childs, Sun Mar 22 14:45:21 CDT 2009
#   Remove Nek3D target ... reader is in the process of becoming deprecated.
#
#   Tom Fogal, Mon May  4 17:43:32 MDT 2009
#   (Temporarily) remove paraDIS reader, to get a nightly test run.
#
#   Jeremy Meredith, Mon May 11 17:14:29 EDT 2009
#   Adding LAMMPS backport from trunk.
#
##############################################################################

@SET_MAKE@
@VARIABLES@
all: message
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

BOXLIB2D=Boxlib2D
BOXLIB3D=Boxlib3D
CFITSIO=FITS
CGNS=CGNS
EXODUS=Exodus TimeVaryingExodus
GDAL=GDAL
HDF4=Cosmos ZeusMP Enzo
HDF5_TARGET= \
	Chombo \
	CosmosPP \
	FLASH \
	GTC \
	H5Nimrod \
	M3D \
	PFLOTRAN \
	Pixie \
	SAMRAI \
	Tetrad \
	UNIC \
	XDMF

MILI=Mili
SILO_TARGET=Silo SAMI Vista
PDB_TARGET=Cale KullLite PDB
NETCDF=NETCDF S3D
VISUS=ViSUS
H5PART=H5Part
FASTBIT=HDF_UC
CCMIO=CCM
SIMULATION=SimV1 SimV1Writer SimV2

SAMPLES=Rect Hex StreamGhostTest

OPTIONAL= VLI

REQUIRED=\
 ANALYZE \
 ANSYS \
 AUXFile \
 AugDecomp \
 BOV \
 BOW \
 CEAucd \
 Claw \
 CMAT \
 CTRL \
 Curve2D \
 DDCMD \
 Dyna3D \
 EnSight \
 ExtrudedVol \
 Gadget \
 GGCM \
 Fluent \
 Image \
 LAMMPS \
 Lines \
 MFIX \
 MatrixMarket \
 Miranda \
 MM5 \
 NASTRAN \
 Nek5000 \
 OpenFOAM \
 OVERFLOW \
 paraDIS \
 paraDIS_tecplot \
 PATRAN \
 PLOT2D \
 PLOT3D \
 PlainText \
 Point3D \
 ProteinDataBank \
 RAW \
 SAR \
 SAS \
 STL \
 Shapefile \
 Spheral \
 TFT \
 TSurf \
 Tecplot \
 VASP \
 Vis5D \
 VTK \
 WavefrontOBJ \
 Xmdv \
 XYZ \
 ZipWrapper

# The following is a minimal subset of the OPTIONAL/REQUIRED plugins
MINIMAL=Curve2D RAW VTK

THIRDPARTY_DEPENDENT=@EXODUS@ @HDF4@ @HDF5_TARGET@ @SILO_TARGET@ @PDB_TARGET@ @MILI@ @BOXLIB2D@ @BOXLIB3D@ @VISUS@ @NETCDF@ @CGNS@ @GDAL@ @CFITSIO@ @ITAPS_C@ @H5PART@ @CCMIO@ @SIMULATION@ @FASTBIT@

SUBDIRS=@DB_BUILD_DIRS@
ALLSUBDIRS=$(REQUIRED) $(THIRDPARTY_DEPENDENT) $(SAMPLES) $(OPTIONAL)

message:
	@echo
	@echo "****************************************************************************"
	@echo "****************************************************************************"
	@echo "***"
	@echo "*** Building Databases"
	@echo "***"
	@echo "****************************************************************************"
	@echo "****************************************************************************"


dirmakefiles_old:
	for dir in $(ALLSUBDIRS); do if test -d $$dir; then (cd $$dir && ../../bin/xml2makefile -noprint -clobber $${dir}.xml) || exit 1; fi; done

dirmakefiles:
	@files=""; for dir in $(ALLSUBDIRS); do if test -d $$dir; then files="$$files $$dir/$${dir}.xml"; fi; done; \
        ../bin/xml2makefile -noprint -clobber -outputtoinputdir $$files

dirmakefiles_dbio_only:
	for dir in $(ALLSUBDIRS); do if test -d $$dir; then (cd $$dir && ../../bin/db_xml2makefile $${dir}.xml) || exit 1; fi; done

clean:
	-$(RM) $(LIB)
	for dir in $(SUBDIRS); do (cd $$dir && test ! -f Makefile || $(MAKE) $@) || exit 1; done
	-$(RM) $(CLEAN_FILES)

#
# Note the loop for ITAPS_* dirs here is to remove any copies
# that got created during configure. Those copies will intentionally
# have all source files set to read-only. If we encounter an ITAPS_
# dir in which that is NOT the case, we skip it so we don't
# inadvertently remove something that someone was editing. The
# ITAPS_C dir is the real source dir so we never remove that.
#
distclean:
	if test -n "$(ALLSUBDIRS)"; then \
		rev=""; for dir in $(ALLSUBDIRS); do rev="$$dir $$rev"; done; \
		for dir in $$rev; do (cd $$dir || exit && test ! -f Makefile || $(MAKE) $@); done \
	fi
	for dir in ITAPS_*; do \
	    if test $$dir == ITAPS_C; then \
	        continue; \
	    fi; \
	    for f in $$dir/*.[Chc]; do \
	        if test -w $$f; then \
	            echo "Skipping deletion of $$dir"; \
	            continue 2; \
	        fi; \
	    done; \
	    $(RM) -r $$dir; \
	done
	-$(RM) $(DISTCLEAN_FILES) *~ core
	-$(RM) $(LIB)
	-$(RM) $(CLEAN_FILES)
	-$(RM) Makefile

depend: dirmakefiles
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

checkdep: dirmakefiles
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

