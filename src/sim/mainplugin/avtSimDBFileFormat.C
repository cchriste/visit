// ************************************************************************* //
//                            avtSimDBFileFormat.C                           //
// ************************************************************************* //

#include <avtSimDBFileFormat.h>

#include <string>

#include <vtkFloatArray.h>
#include <vtkRectilinearGrid.h>
#include <vtkStructuredGrid.h>
#include <vtkUnstructuredGrid.h>

#include <avtDatabaseMetaData.h>

#include <InvalidVariableException.h>

#include <avtDatabase.h>
#include <visitstream.h>

using     std::string;

// ****************************************************************************
//  Method: avtSimDB constructor
//
//  Programmer: Jeremy Meredith
//  Creation:   March 25, 2004
//
// ****************************************************************************

avtSimDBFileFormat::avtSimDBFileFormat(const char *filename)
    : avtSTMDFileFormat(&filename, 1)
{
    if (avtDatabase::OnlyServeUpMetaData())
    {
        ifstream in(filename);

        char buff[256];
        in >> buff;
        if (string(buff) != "host")
        {
            cerr << "not a valid sim file\n";
        }
        in >> host;

        in >> buff;
        if (string(buff) != "port")
        {
            cerr << "not a valid sim file\n";
        }
        in >> port;

        in.close();
    }
}

// ****************************************************************************
//  Method: avtSimDBFileFormat::FreeUpResources
//
//  Purpose:
//      When VisIt is done focusing on a particular timestep, it asks that
//      timestep to free up any resources (memory, file descriptors) that
//      it has associated with it.  This method is the mechanism for doing
//      that.
//
//  Programmer: meredith -- generated by xml2info
//  Creation:   Mon Jan 12 14:24:06 PST 2004
//
// ****************************************************************************

void
avtSimDBFileFormat::FreeUpResources(void)
{
}


// ****************************************************************************
//  Method: avtSimDBFileFormat::PopulateDatabaseMetaData
//
//  Purpose:
//      This database meta-data object is like a table of contents for the
//      file.  By populating it, you are telling the rest of VisIt what
//      information it can request from you.
//
//  Programmer: Jeremy Meredith
//  Creation:   March 25, 2004
//
// ****************************************************************************

void
avtSimDBFileFormat::PopulateDatabaseMetaData(avtDatabaseMetaData *md)
{
    md->SetIsSimulation(true);
    md->SetSimHost(host);
    md->SetSimPort(port);
    AddMeshToMetaData(md, "mesh", AVT_CURVILINEAR_MESH, NULL,
                      1, 0, 3, 3);
    AddScalarVarToMetaData(md, "speed", "mesh", AVT_NODECENT);
    AddScalarVarToMetaData(md, "density", "mesh", AVT_ZONECENT);
}


// ****************************************************************************
//  Method: avtSimDBFileFormat::GetMesh
//
//  Purpose:
//      Gets the mesh associated with this file.  The mesh is returned as a
//      derived type of vtkDataSet (ie vtkRectilinearGrid, vtkStructuredGrid,
//      vtkUnstructuredGrid, etc).
//
//  Arguments:
//      domain      The index of the domain.  If there are NDomains, this
//                  value is guaranteed to be between 0 and NDomains-1,
//                  regardless of block origin.
//      meshname    The name of the mesh of interest.  This can be ignored if
//                  there is only one mesh.
//
//  Programmer: meredith -- generated by xml2info
//  Creation:   Mon Jan 12 14:24:06 PST 2004
//
// ****************************************************************************
vtkDataSet *
avtSimDBFileFormat::GetMesh(int domain, const char *meshname)
{
    return NULL;
}


// ****************************************************************************
//  Method: avtSimDBFileFormat::GetVar
//
//  Purpose:
//      Gets a scalar variable associated with this file.  Although VTK has
//      support for many different types, the best bet is vtkFloatArray, since
//      that is supported everywhere through VisIt.
//
//  Arguments:
//      domain     The index of the domain.  If there are NDomains, this
//                 value is guaranteed to be between 0 and NDomains-1,
//                 regardless of block origin.
//      varname    The name of the variable requested.
//
//  Programmer: Jeremy Meredith
//  Creation:   March 25, 2004
//
// ****************************************************************************

vtkDataArray *
avtSimDBFileFormat::GetVar(int domain, const char *varname)
{
    return NULL;
}


// ****************************************************************************
//  Method: avtSimDBFileFormat::GetVectorVar
//
//  Purpose:
//      Gets a vector variable associated with this file.  Although VTK has
//      support for many different types, the best bet is vtkFloatArray, since
//      that is supported everywhere through VisIt.
//
//  Arguments:
//      domain     The index of the domain.  If there are NDomains, this
//                 value is guaranteed to be between 0 and NDomains-1,
//                 regardless of block origin.
//      varname    The name of the variable requested.
//
//  Programmer: Jeremy Meredith
//  Creation:   March 25, 2004
//
// ****************************************************************************

vtkDataArray *
avtSimDBFileFormat::GetVectorVar(int domain, const char *varname)
{
    return NULL;
}
