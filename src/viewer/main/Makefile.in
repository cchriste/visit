#                         Copyright (c) 2000 - 2006
#                 The Regents of the University of California
#            Produced at the Lawrence Livermore National Laboratory
#            Written by Sean Ahern, Kathleen Bonnell, Eric Brugger,
#           Hank Childs, Jeremy Meredith, Mark Miller, Brad Whitlock
#                              UCRL-CODE-220908
#                            All rights reserved.
#
# This file is part of VisIt. For details, see http://www.llnl.gov/visit/.
#
# Redistribution  and  use  in  source  and  binary  forms,  with  or  without
# modification, are permitted provided  that the following conditions are met:
#
# - Redistributions of  source code  must retain  the above  copyright notice,
#   this list of conditions and the disclaimer below.
# - Redistributions in binary form must  reproduce the above copyright notice,
#   this  list of  conditions  and  the  disclaimer  (as noted below)  in  the
#   documentation and/or materials provided with the distribution.
# - Neither the name of the  UC/LLNL nor the names of  its contributors may be
#   used to endorse  or promote products  derived from  this software  without
#   specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE  COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR  IMPLIED WARRANTIES,  INCLUDING, BUT NOT  LIMITED TO, THE
# IMPLIED WARRANTIES  OF MERCHANTABILITY AND FITNESS FOR  A PARTICULAR PURPOSE
# ARE  DISCLAIMED.  IN  NO  EVENT  SHALL  THE  REGENTS  OF  THE  UNIVERSITY OF
# CALIFORNIA, THE U.S. DEPARTMENT OF ENERGY  OR CONTRIBUTORS BE LIABLE FOR ANY
# DIRECT, INDIRECT,  INCIDENTAL, SPECIAL, EXEMPLARY, OR  CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF  LIABILITY, WHETHER IN CONTRACT, STRICT  LIABILITY, OR TORT
# (INCLUDING  NEGLIGENCE OR  OTHERWISE) ARISING IN ANY  WAY OUT OF  THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# Additional BSD Notice
#
# 1. This notice is required  to be provided under our  contract with the U.S.
#    Department of Energy  (DOE). This work was produced  at the University of
#    California,  Lawrence Livermore National  Laboratory  under Contract  No.
#    W-7405-ENG-48 with the DOE.
#
# 2. Neither the  United States Government  nor the  University of  California
#    nor any of their  employees, makes  any warranty, express  or implied, or
#    assumes any liability  or responsibility for the  accuracy, completeness,
#    or  usefulness  of  any  information,   apparatus,  product,  or  process
#    disclosed, or represents that its  use would not infringe privately-owned
#    rights.
#
# 3. Also, reference herein  to any specific commercial  products, process, or
#    services by trade  name, trademark,  manufacturer  or otherwise  does not
#    necessarily  constitute  or imply  its  endorsement,  recommendation,  or
#    favoring by the United States Government or the University of California.
#    The views and  opinions of authors  expressed herein  do not  necessarily
#    state or reflect those of the  United States Government or the University
#    of  California,  and  shall  not  be  used  for  advertising  or  product
#    endorsement purposes.
#
# Modifications:
#    Jeremy Meredith, Fri Aug  4 16:42:44 PDT 2000
#    Changed source listing to use SRC=$(OBJ:.o=.C).  This allows parsing
#    of this Makefile.in for object files inside configure.
#    Cleaned up some stuff, too.
#
#    Jeremy Meredith, Tue Aug  8 13:45:29 PDT 2000
#    Added shared .o files as dependencies of the binaries.  Also, added
#    targets for all the shared .o files to prevent trying to rebuild
#    them.  It cannot do it correctly automatically.
#
#    Jeremy Meredith, Wed Aug  9 14:32:09 PDT 2000
#    Added RPCs to the Viewer and engine.
#
#    Jeremy Meredith, Mon Aug 14 10:16:09 PDT 2000
#    Added RPCs to viewer.
#
#    Jeremy Meredith, Thu Aug 17 15:58:11 PDT 2000
#    Added RPCs to cli.
#
#    Brad Whitlock, Thu Aug 31 13:29:25 PST 2000
#    I added PROXY_OBJ so the GUI knows which object files it needs to
#    use the viewer proxy.
#
#    Jeremy Meredith, Thu Sep  7 13:17:08 PDT 2000
#    Added the new engine RPCs.
#
#    Kathleen Bonnell, Wed Oct 11 09:28:25 PDT 2000
#    Added ViewerOnionPeelOperator and added visit_vtk library.
#
#    Brad Whitlock, Fri Oct 27 15:26:03 PST 2000
#    I added Qt stuff.
#
#    Jeremy Meredith, Fri Nov 17 16:13:25 PST 2000
#    Removed -lexception.
#
#    Brad Whitlock, Mon Nov 27 14:27:18 PST 2000
#    I made ViewerWindowManager go through the moc.
#
#    Eric Brugger, Wed Dec  6 13:00:43 PST 2000
#    I removed CXXFLAGS from the link line.
#
#    Brad Whitlock, Mon Dec 11 13:20:25 PST 2000
#    I added ViewerPalette.[Ch]
#
#    Jeremy Meredith, Wed Dec 13 11:29:50 PST 2000
#    Added MaterialSelectOperator.
#
#    Hank Childs, Fri Dec 29 10:25:39 PST 2000
#    Switched ordering of pipeline lib with viswindow and plotter.
#
#    Hank Childs, Wed Jan 10 13:24:06 PST 2001
#    Added volume plots.
#
#    Hank Childs, Wed Jan 31 09:54:48 PST 2001
#    Add utility library since some of the volume rendered stuff relies on it.
#
#    Eric Brugger, Mon Feb 26 16:40:20 PST 2001
#    I moved all the plot specific files to the plot directory.
#
#    Hank Childs, Thu Mar 15 08:36:40 PST 2001
#    Removed unused Silo libraries.
#
#    Eric Brugger, Tue Mar 13 08:32:34 PST 2001
#    I changed the makefile to add -lvplot to the load line to load in the
#    viewer specific portion of the plugin manager.
#
#    Jeremy Meredith, Wed Mar 28 14:07:51 PST 2001
#    Renamed -lplot to be a viewer specific set of plugins.
#
#    Brad Whitlock, Mon Apr 23 14:06:50 PST 2001
#    Added ViewerMessaging.C
#
#    Hank Childs, Tue Apr 24 15:21:43 PDT 2001
#    Added includes for vtk initialization.
#
#    Jeremy Meredith, Fri Apr 27 15:43:19 PDT 2001
#    Swapped -lcomm and -lmisc.  Added ViewerPasswordWindow.
#
#    Jeremy Meredith, Fri May 11 13:44:35 PDT 2001
#    Made all the .o's but the main one build a shared libviewer library.
#    Link against -lqgl optionally.
#
#    Kathleen Bonnell, Mon May  7 15:58:13 PDT 2001 
#    Added ViewerEraseOperator. 
#
#    Hank Childs, Wed Jun 13 15:12:40 PDT 2001
#    Changed libmetadata to libdbatts.
#
#    Brad Whitlock, Thu Jun 14 16:04:59 PST 2001
#    Added new color table files.
#
#    Hank Childs, Fri Jul 20 08:04:07 PDT 2001
#    Removed ViewerMaterialSelect.
#
#    Jeremy Meredith, Mon Jul 23 00:41:31 PDT 2001
#    Added some required libraries for AIX.
#
#    Jeremy Meredith, Thu Jul 26 03:26:42 PDT 2001
#    Added support for operator plugins.
#
#    Jeremy Meredith, Fri Jul 27 13:47:16 PDT 2001
#    Added @PX@ to libplugin.  Made "make clean" remove viewer.o.
#
#    Jeremy Meredith, Tue Sep  4 10:31:52 PDT 2001
#    Changed library building: the LIB targets has no extension, and
#    either LIBSINGLETARGETS or LIBMULTITARGETS must be included
#    in addition to TARGETS depending on whether the library is build
#    from object files in one directory or multiple subdirectories.
#
#    Sean Ahern, Mon Sep 24 14:40:27 PDT 2001
#    Added the ExpressionsList.  Added automatic moc rules.  Restructured
#    the Makefile a bit.
#
#    Brad Whitlock, Tue Oct 16 16:22:49 PST 2001
#    Made it link with the avtmath library.
#
#    Brad Whitlock, Fri Nov 2 10:19:32 PDT 2001
#    Added the ViewerWindowManagerAttributes.C file.
#
#    Brad Whitlock, Mon Feb 4 16:47:47 PST 2002
#    Made it use libwinutil.
#
#    Brad Whitlock, Thu Feb 7 16:54:10 PST 2002
#    Added purify and quantify targets.
#
#    Brad Whitlock, Thu Feb 21 15:19:16 PST 2002
#    Added vtkqt to the include path.
#
#    Brad Whitlock, Wed Mar 13 14:08:03 PST 2002
#    I removed support for the qgl library since we now only support Qt 2.3.x
#    and later which does not have that library.
#
#    Brad Whitlock, Tue Mar 26 15:21:27 PST 2002
#    I removed the rpc library.
#
#    Sean Ahern, Thu Apr 18 13:37:45 PDT 2002
#    Retrofitted to use Jeremy's parser.
#
#    Brad Whitlock, Fri May 3 17:16:19 PST 2002
#    Added ViewerServerManager.
#
#    Brad Whitlock, Fri Jun 28 16:11:27 PST 2002
#    Moved a couple parser files to this directory.
#
#    Jeremy Meredith, Fri Jul 12 14:30:12 PDT 2002
#    Unified include directories.  Changed moc location.
#
#    Jeremy Meredith, Wed Aug 14 17:29:47 PDT 2002
#    Added ViewerEngineLauncher.
#
#    Brad Whitlock, Fri Sep 27 16:30:27 PST 2002
#    Renamed ViewerEngineLauncher to ViewerEngineChooser. I also added
#    the ViewerConnectionProgressDialog.
#
#    Sean Ahern, Fri Oct  4 11:26:05 PDT 2002
#    Moved most of the parser code to its own library.
#
#    Brad Whitlock, Wed Nov 20 13:32:34 PST 2002
#    I removed ViewerPalette.{C,h} and ViewerColorTables.{C,h}
#
#    Brad Whitlock, Wed Jan 29 13:56:14 PST 2003
#    I added source files for toolbar actions.
#
#    Kathleen Bonnell, Wed Feb  5 09:06:10 PST 2003  
#    Added ViewerHostProfileSelectorNoWin, ViewerHostProfileSelectorWithWin. 
#
#    Sean Ahern, Wed Feb  5 15:27:11 PST 2003
#    Removed the ViewerExpr stuff since it doesn't differ from the global ones.
#
#    Kathleen Bonnell,  Wed Mar  5 11:32:18 PST 2003 
#    Added LineoutListItem.
#
#    Brad Whitlock, Wed Mar 12 15:04:49 PST 2003
#    Added PlotAndOperatorActions.C
#
#    Brad Whitlock, Fri May 2 15:49:25 PST 2003
#    I added -lproxybase, -lvclproxy, and -lvclrpc to the list of libs.
#
#    Jeremy Meredith, Thu Jun 26 10:39:54 PDT 2003
#    Renamed ViewerEngineChooser to ViewerRemoteProcessChooser.
#
#    Hank Childs, Thu Jun 26 23:29:07 PDT 2003
#    Link against the expressions library -- this is very unfortunate, but
#    necessary for the way we have plots set up now.  The Histogram plot
#    uses the histogram filter, which uses an expression.
#
#    Sean Ahern, Wed Jul  2 14:41:46 PDT 2003
#    Removed the link against the expressions library.  This fails with my
#    new expressions engine.
#
#    Hank Childs, Sat Jan 24 11:34:44 PST 2004
#    Changed link-line to accomodate library re-organization.
#
#    Hank Childs, Thu Mar  4 08:08:19 PST 2004
#    Add a new library for a Qt vis window.
#
#    Brad Whitlock, Tue Feb 3 15:50:56 PST 2004
#    I removed ViewerAnimation.C
#
#    Brad Whitlock, Thu Mar 25 17:12:04 PST 2004
#    I took some classes out of the viewer library and put them into the
#    viewer proper because they should not be available to plugins.
#
#    Jeremy Meredith, Tue Mar 30 10:16:44 PST 2004
#    Added EngineKey.
#
#    Brad Whitlock, Fri Apr 9 09:09:28 PDT 2004
#    Moved moc files into viewer proper.
#
#    Jeremy Meredith, Tue Aug 24 21:28:02 PDT 2004
#    Added metadata and SIL observers.
#
#    Jeremy Meredith, Mon Aug 30 18:05:21 PDT 2004
#    Added the serial version of the "parallel" visit_vtk directory.
#
#    Jeremy Meredith, Tue Nov 23 14:53:07 PST 2004
#    Refactored the expression parser into two separate libraries.
#
#    Brad Whitlock, Wed Jan 5 09:25:20 PDT 2005
#    Added -lexpr for MacOS X.
#
#    Brad Whitlock, Tue Apr 12 09:55:58 PDT 2005
#    Made certain libraries be ser/par to link parallel VisIt on MacOS X.
#
#    Brad Whitlock, Mon May 2 10:39:56 PDT 2005
#    Added support for multiple clients driving the viewer.
#
#    Eric Brugger, Wed Nov 23 08:00:06 PST 2005
#    Added PLATFORM_CPPFLAGS.
#
#    Mark C. Miller, Mon Dec 12 20:53:03 PST 2005
#    Added BZIP2_LIBS variable
#
#    Brad Whitlock, Tue Mar 7 17:53:45 PST 2006
#    Added ViewStack.C
#
##############################################################################

##
## Programs and options...
##
@SET_MAKE@
@VARIABLES@

##
## Libraries and includes...
##
LIB=libviewer

VTK_LIBS=@VTK_LIBS@
VTK_INCLUDE=@VTK_INCLUDES@
LIBS=-L../../lib -L../../vtkqt -lengineproxy -lenginerpc -lviewerrpc \
     -lmdserverproxy -lmdserverrpc -lvclproxy -lvclrpc -ldbatts -lexpr \
     -lexpr -lparser -lplugin -lqtviswindow -lviswindow_ser -lavtmath_ser -lplotter_ser \
     -lavtfilters_ser -lavtwriter_ser -lavtview -lpipeline_ser -lvisit_vtk \
     -llightweight_visit_vtk -lparallel_visit_vtk_ser -lvtkqt -lwinutil \
     @QT_LIBS@ -lproxybase -lmisc -lcomm -lstate -lutility -lavtexceptions \
     $(VTK_LIBS) $(X_LIBS) $(BZIP2_LIBS) @LIBS@ @PTHREAD_LIB@

LDFLAGS=@LDFLAGS@ @QT_LDFLAGS@
LIBDEP=
MOC=@QT_MOC@
CXXFLAGS=@CXXFLAGS@ @QT_CXXFLAGS@ 
CPPFLAGS=@PLATFORM_CPPFLAGS@ @CPPFLAGS@ $(VTK_INCLUDE) -I../../vtkqt \
         -I./icons -I../../include -I../../include/visit -I.



##
## Files...
##

PUBLIC_SRC= \
    ViewerMessaging.C \
    ViewerOperator.C \
    ViewerPlot.C \
    ViewerState.C \
    ViewerSubject.C

PRIVATE_SRC=\
    ActionGroupDescription.C \
    AnimationActions.C \
    EngineKey.C \
    LineoutListItem.C \
    LockActions.C \
    NoEngineException.C \
    PlotAndOperatorActions.C \
    ViewActions.C \
    ViewStack.C \
    ViewerAction.C \
    ViewerActionBase.C \
    ViewerActionManager.C \
    ViewerClientConnection.C \
    ViewerConfigManager.C \
    ViewerConnectionProgressDialog.C \
    ViewerEngineManager.C \
    ViewerFileServer.C \
    ViewerHostProfileSelector.C \
    ViewerHostProfileSelectorNoWin.C \
    ViewerHostProfileSelectorWithWin.C \
    ViewerMasterXfer.C \
    ViewerMessageBuffer.C \
    ViewerMetaDataObserver.C \
    ViewerMultipleAction.C \
    ViewerOperatorFactory.C \
    ViewerPasswordWindow.C \
    ViewerPlotFactory.C \
    ViewerPlotList.C \
    ViewerPopupMenu.C \
    ViewerQuery.C \
    ViewerQueryManager.C \
    ViewerRemoteProcessChooser.C \
    ViewerRPCObserver.C \
    ViewerServerManager.C \
    ViewerSILAttsObserver.C \
    ViewerToggleAction.C \
    ViewerToolbar.C \
    ViewerWindow.C \
    ViewerWindowManager.C \
    ViewerWindowManagerAttributes.C \
    WindowActions.C

MAINSRC=viewer.C

HDRMOC = \
    PlotAndOperatorActions.h \
    ViewerAction.h \
    ViewerActionBase.h \
    ViewerClientConnection.h \
    ViewerConnectionProgressDialog.h \
    ViewerHostProfileSelectorWithWin.h \
    ViewerMetaDataObserver.h \
    ViewerMultipleAction.h \
    ViewerPasswordWindow.h \
    ViewerRPCObserver.h \
    ViewerSILAttsObserver.h \
    ViewerSubject.h \
    ViewerWindowManager.h

SRCMOC=${HDRMOC:.h=_moc.C}

VIEWERLIB_SRC=@VIEWERLIB_SRC@
VIEWEREXE_SRC=@VIEWEREXE_SRC@

##
## On MacOS X, here are the expansions
##
## VIEWERLIB_SRC=$(PUBLIC_SRC) $(PRIVATE_SRC) $(SRCMOC)
## VIEWEREXE_SRC=$(MAINSRC)
##
## On other Unix versions, here are the expansions.
##
## VIEWERLIB_SRC=$(PUBLIC_SRC)
## VIEWEREXE_SRC=$(MAINSRC) $(PRIVATE_SRC) $(SRCMOC)
##

VIEWERLIB_OBJ=${VIEWERLIB_SRC:.C=.o}
VIEWEREXE_OBJ=${VIEWEREXE_SRC:.C=.o}
OBJ=$(VIEWERLIB_OBJ)

##
## Standard targets...
##

all: $(LIBSHARED) $(tmpbin)/viewer

install: install_bin

clean:
	$(RM) $(VIEWERLIB_OBJ) $(VIEWEREXE_OBJ) $(SRCMOC) $(LIBSHARED) $(tmpbin)/viewer

##
## Other targets...
##
$(tmpbin)/viewer: $(LIBDEP) $(VIEWEREXE_OBJ) $(LIBSHARED)
	$(CXX) -o $@ $(VIEWEREXE_OBJ) $(LDFLAGS) -lviewer $(LIBS)

purify: $(LIBDEP) $(VIEWEREXE_OBJ) $(LIBSHARED)
	purify -cache-dir=$(TOPDIR)/lib -always-use-cache-dir $(CXX) -o $(tmpbin)/viewer $(VIEWEREXE_OBJ) $(LDFLAGS) -lviewer $(LIBS)

quantify: $(LIBDEP) $(VIEWEREXE_OBJ) $(LIBSHARED)
	quantify $(CXX) -o $(tmpbin)/viewer $(VIEWEREXE_OBJ) $(LDFLAGS) -lviewer $(LIBS)

install_bin: $(tmpbin)/viewer
	$(INSTALL) $(tmpbin)/viewer $(bindir)

moc: $(SRCMOC)

##
## Source file specific rules
##
${SRCMOC}:
	${MOC} ${@:_moc.C=.h} > $@

##
## Automatic dependency stuff
##
@TARGETS@
@LIBTARGETS@
